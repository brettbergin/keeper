{% extends "base.html" %}

{% block title %}Demo Login - Keeper{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6 col-lg-4">
        <div class="card shadow">
            <div class="card-body p-4">
                <div class="text-center mb-4">
                    <i class="fas fa-user-circle fa-3x text-primary mb-3"></i>
                    <h3>Demo Login</h3>
                    <p class="text-muted">For development and testing only</p>
                </div>
                
                <form method="POST">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    <div class="mb-3">
                        <label for="email" class="form-label">Email Address</label>
                        <input type="email" class="form-control" id="email" name="email" required 
                               placeholder="user@company.com" value="{{ request.form.get('email', '') }}">
                    </div>
                    
                    <div class="mb-3">
                        <label for="username" class="form-label">Username</label>
                        <input type="text" class="form-control" id="username" name="username" required 
                               placeholder="username" value="{{ request.form.get('username', '') }}">
                        <div class="form-text">Username must be unique and contain only letters, numbers, dots, hyphens, and underscores.</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="full_name" class="form-label">Full Name</label>
                        <input type="text" class="form-control" id="full_name" name="full_name" 
                               placeholder="Your Full Name" value="{{ request.form.get('full_name', '') }}">
                    </div>
                    
                    <div class="mb-4">
                        <label for="role" class="form-label">Role</label>
                        <select class="form-select" id="role" name="role" required>
                            <option value="">Select a role...</option>
                            <option value="user" {{ 'selected' if request.form.get('role') == 'user' else '' }}>
                                游녻 User - Basic access to dev/staging environments
                            </option>
                            <option value="manager" {{ 'selected' if request.form.get('role') == 'manager' else '' }}>
                                游논 Manager - Can approve operations and manage specific environments
                            </option>
                            <option value="admin" {{ 'selected' if request.form.get('role') == 'admin' else '' }}>
                                游댢 Administrator - Full system access and user management
                            </option>
                        </select>
                        <div class="form-text">Role determines what environments and actions you can access.</div>
                    </div>
                    
                    <div class="mb-4" id="managed-environments" style="display: none;">
                        <label class="form-label">Managed Environments (Manager Role)</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="staging" id="env-staging" name="managed_environments">
                            <label class="form-check-label" for="env-staging">Staging</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="production" id="env-production" name="managed_environments">
                            <label class="form-check-label" for="env-production">Production</label>
                        </div>
                        <div class="form-text">Select which environments this manager can approve operations for.</div>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-sign-in-alt me-2"></i>Login
                        </button>
                        <a href="{{ url_for('auth.login') }}" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left me-2"></i>Back to Login
                        </a>
                    </div>
                </form>
                
                <div class="mt-4">
                    <div class="alert alert-warning alert-sm">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Development Mode:</strong> This demo login is for development purposes only. 
                        In production, authentication should be handled via SAML/SSO.
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Login Presets -->
<div class="row justify-content-center mt-4">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-users me-2"></i>Quick Login Presets</h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <div class="card border-danger">
                            <div class="card-body p-3">
                                <h6 class="card-title text-danger">游댢 Administrator</h6>
                                <p class="card-text small">
                                    <strong>Email:</strong> admin@company.com<br>
                                    <strong>Username:</strong> admin<br>
                                    <strong>Name:</strong> System Administrator<br>
                                    <strong>Access:</strong> Full system control
                                </p>
                                <button class="btn btn-sm btn-danger w-100" onclick="fillForm('admin@company.com', 'admin', 'System Administrator', 'admin')">
                                    Use Admin Profile
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card border-warning">
                            <div class="card-body p-3">
                                <h6 class="card-title text-warning">游논 Manager</h6>
                                <p class="card-text small">
                                    <strong>Email:</strong> manager@company.com<br>
                                    <strong>Username:</strong> staging.manager<br>
                                    <strong>Name:</strong> Staging Manager<br>
                                    <strong>Access:</strong> Approves staging operations
                                </p>
                                <button class="btn btn-sm btn-warning w-100" onclick="fillForm('manager@company.com', 'staging.manager', 'Staging Manager', 'manager', ['staging'])">
                                    Use Manager Profile
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card border-info">
                            <div class="card-body p-3">
                                <h6 class="card-title text-info">游녻 User</h6>
                                <p class="card-text small">
                                    <strong>Email:</strong> user@company.com<br>
                                    <strong>Username:</strong> demo.user<br>
                                    <strong>Name:</strong> Demo User<br>
                                    <strong>Access:</strong> Dev/staging secrets
                                </p>
                                <button class="btn btn-sm btn-info w-100" onclick="fillForm('user@company.com', 'demo.user', 'Demo User', 'user')">
                                    Use User Profile
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row mt-3">
                    <div class="col-md-6">
                        <div class="card border-secondary">
                            <div class="card-body p-3">
                                <h6 class="card-title text-secondary">游논 Production Manager</h6>
                                <p class="card-text small">
                                    <strong>Email:</strong> prod.manager@company.com<br>
                                    <strong>Username:</strong> prod.manager<br>
                                    <strong>Name:</strong> Production Manager<br>
                                    <strong>Access:</strong> Approves production operations
                                </p>
                                <button class="btn btn-sm btn-secondary w-100" onclick="fillForm('prod.manager@company.com', 'prod.manager', 'Production Manager', 'manager', ['production'])">
                                    Use Prod Manager Profile
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card border-success">
                            <div class="card-body p-3">
                                <h6 class="card-title text-success">游논 Multi-Environment Manager</h6>
                                <p class="card-text small">
                                    <strong>Email:</strong> ops.manager@company.com<br>
                                    <strong>Username:</strong> ops.manager<br>
                                    <strong>Name:</strong> Operations Manager<br>
                                    <strong>Access:</strong> Manages staging & production
                                </p>
                                <button class="btn btn-sm btn-success w-100" onclick="fillForm('ops.manager@company.com', 'ops.manager', 'Operations Manager', 'manager', ['staging', 'production'])">
                                    Use Ops Manager Profile
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function fillForm(email, username, fullName, role, managedEnvironments = []) {
    document.getElementById('email').value = email;
    document.getElementById('username').value = username;
    document.getElementById('full_name').value = fullName;
    document.getElementById('role').value = role;
    
    // Show/hide managed environments section
    toggleManagedEnvironments();
    
    // Clear all environment checkboxes first
    document.querySelectorAll('input[name="managed_environments"]').forEach(checkbox => {
        checkbox.checked = false;
    });
    
    // Check the specified managed environments
    if (managedEnvironments && managedEnvironments.length > 0) {
        managedEnvironments.forEach(env => {
            const checkbox = document.getElementById(`env-${env}`);
            if (checkbox) {
                checkbox.checked = true;
            }
        });
    }
}

function toggleManagedEnvironments() {
    const roleSelect = document.getElementById('role');
    const managedEnvSection = document.getElementById('managed-environments');
    
    if (roleSelect.value === 'manager') {
        managedEnvSection.style.display = 'block';
    } else {
        managedEnvSection.style.display = 'none';
    }
}

// Add event listener for role changes
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('role').addEventListener('change', toggleManagedEnvironments);
    
    // Initialize on page load
    toggleManagedEnvironments();
});
</script>
{% endblock %}